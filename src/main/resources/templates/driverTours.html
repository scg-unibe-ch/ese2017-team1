<!DOCTYPE HTML>
<html xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <title>driverTours</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/css/bootstrap.min.css" integrity="sha384-/Y6pD6FV/Vv2HJnA6t+vslU6fwYXjCFtcEpHbNJ0lyAFsXTsjBbfaDjzALeQsN6M" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" />
</head>
<body style="background-color: #87AFC7">
<h1>
    <div align="left">
        <a href="/driver">
            <img th:src="@{/images/FirmaESE.png}" style="position: absolute; top:0; left: 0;" height="108" width="144"/>
        </a>
    </div>
    <div class="text-right">
        <!-- Logout Button -->
        <a href="/logout">
            <button type="button" class="btn btn-primary btn-lg">
                Logout
            </button>
        </a>
    </div>
</h1>
<br/>
<br/>
<div align="center">
    <h1>Tour</h1>
</div>
<br/>
<div class="container">
<table style="width:100%">
    <thead>
    <tr>
        <td><b><li class="list-group-item list-group-item-warning" th:text="'AuftragsId'"/></b></td>
        <td><b><li class="list-group-item list-group-item-warning" th:text="'Kunde'"/></b></td>
    </tr>
    </thead>
    <tbody>
    <tr th:each="match : ${matches}" id="test">
        <td><li class="list-group-item list-group-item-warning" th:text="${match.id}"/></td>
        <td><li class="list-group-item list-group-item-warning" th:text="${match.client.name}"/></td>
        <td>
            <a th:href="${'/driverProductOrder/'+tour.id+'/'+match.id}">
                <button type="button" class="btn btn-primary btn-lg">
                    mehr
                </button>
            </a>
        </td>
    </tr>
    </tbody>
</table>
<br/>

<!-- Optional JavaScript -->
<!-- jQuery first, then Popper.js, then Bootstrap JS -->
<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js" integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/js/bootstrap.min.js" integrity="sha384-h0AbiXch4ZDo7tp9hKZ4TsHbi047NrKGLO3SEJAg45jXxnGIfYzk4Si90RDIqNm1" crossorigin="anonymous"></script>

<div class="container">
<style>
    #map {
        height: 400px;
        width: 100%;
    }
</style>

<h3><br/> Ihre schnellste Route ist</h3>
<div id="map"></div>
<script th:inline="javascript" >
    /*<![CDATA[*/
    function initMap() {
        var marker1;
        var marker2;
        // Here the map is initialized
        var bernExwi = {lat: 46.951129, lng: 7.438773};
        var bernExwi2 = {lat: 46.95113, lng: 7.43877};
        var directionDisplay;
        var directionsService = new google.maps.DirectionsService();
        directionsDisplay = new google.maps.DirectionsRenderer();
        var map = new google.maps.Map(document.getElementById('map'), {
            zoom: 4,
            center: bernExwi
        });
        // Here the point is set
        marker1 = new google.maps.Marker({
            position: bernExwi,
            map: map
        });
        marker2 = new google.maps.Marker({
            position: bernExwi2,
            map: map
        });
        var addresses = [[${addresses}]];
        var geocoder = new google.maps.Geocoder();
        for (var i = 0; i < addresses.length; i++) {
            codeAddress(addresses[i]);
        }

        directionsDisplay.setMap(map);
        calcRoute();


        function codeAddress(address) {
            geocoder.geocode({address: address}, function (results, status) {
                if (status == google.maps.GeocoderStatus.OK) {
                    map.setCenter(results[0].geometry.location);//center the map over the result
                    //place a marker at the location
                    var marker = new google.maps.Marker(
                        {
                            map: map,
                            position: results[0].geometry.location
                        });
                    return results[0].geometry.location
                } else {
                    alert('Geocode was not successful for the following reason: ' + status);
                }
            });
        }

        function calcRoute() {
            var waypts = [];


            for (var i = 0; i < addresses.length; i++) {
                var addr = addresses[i];
                if (addr !== "") {
                    waypts.push({
                        location: addr,
                        stopover: true
                    });
                }
            }
            start = bernExwi;
            end =  bernExwi2;
            var request = {
                origin: start,
                destination: end,
                waypoints: waypts,
                optimizeWaypoints: true,
                travelMode: google.maps.DirectionsTravelMode.DRIVING
            };
            directionsService.route(request, function (response, status) {
                if (status == google.maps.DirectionsStatus.OK) {
                    directionsDisplay.setDirections(response);
                    var route = response.routes[0];
                }
            });
        }

    }
    /*]]>*/
</script>
</div>
<br/>
    <div align="center" th:if="${error}">
        <p style="font-size: 20; color: #01579b;">Bevor die Tour abgeschlossen werden kann, müssen alle Aufträge "akzeptiert"
            bzw. "abgelehnt" sein.</p>
    </div>
    <br/>
    <button class="btn btn-primary btn-lg" type="button" onclick="history.back()">Zurück</button>
    <div class="btn-group" role="group" style="float: right" th:if="${noError}">
        <a th:href="${'/endTourCheck/'+tour.id}">
            <button type="button" class="btn btn-primary btn-lg">
                Tour abschliessen
            </button>
        </a>
    </div>
</div>

<script async="async" defer="defer" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBvRi8WcVAqTsx-TC7Xi_spt2wCNTuolyc&amp;callback=initMap"></script>

</body>
</html>